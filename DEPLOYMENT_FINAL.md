# Final Deployment Guide - MBPP Workflows

## âœ… Everything is Automated

When you deploy, the following happens automatically:

### 1. **DynamoDB Tables Created**
- `mbpp-reports` - Stores all tickets
- `mbpp-events` - Tracks workflow events
- Both have TTL (90 days auto-delete)
- GSI on events table for querying by ticket

### 2. **Lambda Functions Updated**
- WebSocket handler gets MBPP Workflow layer
- Automatic permissions to access MBPP tables
- Environment variables configured

### 3. **No Weird Characters**
- All resource names are clean
- No special characters in names
- Simple naming: `mbpp-reports`, `mbpp-events`

## ğŸš€ Single Command Deployment

```bash
cd cdk

# Deploy everything at once
cdk deploy --all --profile test
```

This deploys:
1. âœ… Database tables (sessions, conversations, analytics, events)
2. âœ… MBPP Workflow tables (reports, events)
3. âœ… Lambda functions with workflow integration
4. âœ… API Gateway (WebSocket + HTTP)
5. âœ… All permissions automatically configured

## ğŸ“‹ What Happens Automatically

### WebSocket Handler
- âœ… Gets MBPP Workflow layer
- âœ… Can access `mbpp-reports` table
- âœ… Can access `mbpp-events` table
- âœ… Routes workflow messages automatically
- âœ… Falls back to Nova Pro for RAG

### Frontend (No Changes Needed)
- âœ… Uses same WebSocket endpoint
- âœ… Receives workflow responses
- âœ… Displays as normal messages
- âœ… No code changes required

## ğŸ¯ User Flow (Automated)

```
User: "MBPP website is down"
  â†“ (WebSocket sends to Lambda)
  â†“ (Lambda detects workflow trigger)
  â†“ (MBPP Agent starts complaint workflow)
  â†“ (Response sent back via WebSocket)
  â†“ (Frontend displays: "Would you like to report an incident?")
  â†“ (User continues conversation)
  â†“ (Ticket saved to DynamoDB automatically)
  â†“ (Event logged automatically)
```

## ğŸ“Š Verify Deployment

```bash
# Check if tables exist
aws dynamodb list-tables --profile test | grep mbpp

# Check Lambda has correct environment
aws lambda get-function-configuration \
  --function-name ChatbotLambdaStack-WebSocketHandler \
  --profile test \
  --query 'Environment.Variables'

# Test WebSocket
wscat -c wss://ynw017q5lc.execute-api.ap-southeast-1.amazonaws.com/prod
```

## âœ… Clean Resource Names

All resources have clean names:
- `mbpp-reports` (not `mbpp-reports-a1b2c3`)
- `mbpp-events` (not `mbpp-events-x9y8z7`)
- `chatbot-api-keys` (not `chatbot/api-keys-weird#chars`)

## ğŸ”§ Environment Variables (Auto-Set)

```bash
REPORTS_TABLE=mbpp-reports
EVENTS_TABLE=mbpp-events
BEDROCK_REGION=ap-southeast-1
SESSIONS_TABLE=<auto-generated>
CONVERSATIONS_TABLE=<auto-generated>
```

## ğŸ“ Post-Deployment

Nothing required! The system is ready to use immediately:

1. âœ… Frontend works without changes
2. âœ… Workflows trigger automatically
3. âœ… Reports saved to DynamoDB
4. âœ… Events tracked automatically

## ğŸ‰ Summary

**One command deploys everything:**
```bash
cdk deploy --all --profile test
```

**Zero manual configuration needed:**
- âœ… Tables created automatically
- âœ… Permissions set automatically
- âœ… Integration works automatically
- âœ… Frontend works without changes

**Clean resource names:**
- âœ… No weird characters
- âœ… Simple, readable names
- âœ… Easy to find in AWS Console

---

**Ready to deploy!** Just run `cdk deploy --all --profile test`
